# アイテム設計バイブル (Items & Balance Design) v2.2

このドキュメントは `data/items.ts` および `config/gameBalance.ts` の設計根拠であり、バランス調整の聖典です。

---

## 1. 経済バランスの基本原則

### 1.1 価格設定の方程式
アイテム価格は以下の「効用価値」に基づいて算定します。

$$ Price \approx (ScoreGain \times 150) + (SanityGain \times 20) + (HpGain \times 15) $$

*   **ScoreGain**: 学習進捗（点数換算）の期待値。
*   **SanityGain**: SAN値回復量。
*   **HpGain**: HP回復量。
*   **リスク係数**: 副作用がある場合は価格を **0.8倍〜0.9倍** に割引。

### 1.2 インフレ抑制
所持金は有限です。プレイヤーは常に「安価なカフェインで凌ぐ」か「高価な時短アイテムを買う」かの選択を迫られるように設計します。

---

## 2. カテゴリ別設計ガイドライン

### 2.1 Consumables (消耗品)
即効性のあるリソース回復・変換アイテム。
*   **Food (食事)**: HP回復が主。`Satiety`（満腹度）が増加するため連食不可。
    *   *例: カップ麺 (HP大回復 / 満腹度大)*
*   **Drink (飲料)**: カフェイン操作が主。
    *   *例: エナドリ (カフェイン大増 / SAN微減)*
*   **Candy (菓子)**: 微調整用。安価で低リスク。
    *   *例: グミ (SAN微回復)*

### 2.2 Gadgets (永続・長時間効果)
バフを付与するアイテム。`activeBuffs` 配列に追加される。
*   **設計制約**: 同系統のバフは重複しない（あるいは乗算される）ルールを明確にする。
*   *例: ホットアイマスク (休息効率UP / 4ターン)*

### 2.3 Key Items (重要アイテム)
イベントトリガーやパッシブ効果を持つ非売品。
*   **USBメモリ**: 「60点の壁」を超えるための必須アイテム。
    *   *効果*: 成功時 +20点 / 失敗時 -20 SAN
    *   *成功率*: アルゴリズム知識依存 (Min 30% -> Max 95%)
*   **検証済み過去問**: 上位互換。成功率98%。

---

## 3. アイテムカタログ & バランス・マトリクス

実装済みの主要アイテムとその役割定義です。

| ID | Name | Price | 主効果 | 副作用/コスト | 役割・戦略 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| `BLACK_COFFEE` | 缶コーヒー | 160 | CFN+50 | - | **[基本]** 安価な覚醒維持。 |
| `ENERGY_DRINK` | ZONe | 550 | CFN+120 | SAN-5 | **[瞬発]** 一気にZONEへ。SANを犠牲にする。 |
| `MINERAL_WATER`| 水 | 120 | CFN-15 | - | **[調整]** 中毒回避用。安価。 |
| `HERBAL_TEA` | ハーブティー | 600 | CFN-100 | SAN+35 | **[治療]** 中毒からの緊急脱出。高価。 |
| `RICE_BALL` | おにぎり | 150 | HP+15 | 満腹+50 | **[生存]** 最低限のカロリー摂取。 |
| `CUP_RAMEN` | 激辛カップ麺 | 480 | HP+55 | 満腹+75 | **[回復]** 瀕死からの復帰。連食不可。 |
| `DIGESTIVE_ENZYME`| 消化酵素 | 450 | 満腹-60 | HP-3 | **[コンボ]** 無理やり胃を開ける。 |
| `GAMING_SUPPLEMENT`| ゲーミングサプリ| 4500 | Study x1.2 | SAN-4/turn | **[ブースト]** 中盤の加速装置。 |
| `SMART_DRUG` | 怪しいサプリ | 15800| Study x2.0 | HP-40, SAN-12/t | **[切り札]** 終盤の逆転。破滅的リスク。 |
| `REFERENCE_BOOK`| 「わかる」本 | 12800| 最低科目+15 | - | **[救済]** 金で解決する最後の手段。 |

---

## 4. バフ・デバフ設計 (Status Effects)

### 4.1 STUDY_EFFICIENCY (学習効率)
*   乗算で適用。
*   Soft Cap: 累積倍率が極端に高くならないよう、`applySoftCap` 関数で減衰させる。
*   推奨レンジ: 1.1倍 〜 2.0倍

### 4.2 REST_EFFICIENCY (休息効率)
*   HP/SAN回復量に乗算。
*   睡眠負債（Sleep Debt）の影響を受ける前に適用される。

### 4.3 SANITY_DRAIN (スリップダメージ)
*   毎ターン終了時にSANを減少させる。
*   強力な効果（サプリ等）の代償として設定する。

---

## 5. 追加プロセス (New Item Protocol)

新しいアイテムを追加する際は、以下の手順を踏んでください。

1.  **`types/enums.ts`**: `ItemId` にキーを追加。
2.  **`data/items.ts`**: アイテムデータを定義。
    *   効果は `GameEventEffect` 型に準拠させる。
    *   特殊な挙動（確率発動など）が必要な場合は `logic/handlers/items.ts` に分岐処理を書く。
3.  **`config/gameBalance.ts`**: 必要に応じて価格や効果量の定数を追加。
4.  **`ITEMS_DESIGN.md`**: このドキュメントにアイテムを追加し、意図を記述。

---

## 6. バージョン履歴

*   **v2.1**: `USB_MEMORY` の成功率計算式を変更（アルゴリズム60点で確定成功へ）。`VERIFIED_PAST_PAPERS` の成功率を98%に上方修正。
*   **v2.0**: 満腹度システム導入に伴い、食品系アイテムのパラメータを全面刷新。
*   **v1.0**: 初期リリース。基本セット定義。