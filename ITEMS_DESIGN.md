# アイテム設計バイブル (Items & Balance Design) v2.4

このドキュメントは `data/items.ts` および `config/gameBalance.ts` の設計根拠であり、バランス調整の聖典です。コード構成に関しては行数依存ではなく「語彙境界・変更頻度・テスト容易性・認知的複雑度」を指標とした再編を行う (詳細: `DESIGN_PHILOSOPHY.md` 6章)。

---

## 1. 経済バランスの基本原則

### 1.1 価格設定の方程式 (ROI Revision v2.3)
アイテム価格は「プレイヤーが労働（Work）で費やすターン数」と「得られる効果」のトレードオフで決定します。

$$ Price \approx (ScoreGain \times 100) + (SanityGain \times 15) + (HpGain \times 10) $$

*   **v2.3改定**: 従来の計算式では高額アイテムが割高になりすぎていたため、係数を全体的に下方修正しました。
*   **リスク割引**: 副作用がある場合は、価格を **0.6倍〜0.8倍** に大幅割引し、「リスクを取ってでも使いたい」と思わせる価格設定にします。

### 1.2 インフレ抑制と救済
所持金は有限ですが、終盤に「お金で解決する」選択肢を用意するため、高ティアアイテムの価格を現実的なライン（バイト2-3回分）まで引き下げました。

---

## 2. カテゴリ別設計ガイドライン

### 2.1 Consumables (消耗品)
即効性のあるリソース回復・変換アイテム。
*   **Food (食事)**: HP回復が主。`Satiety`（満腹度）が増加するため連食不可。
    *   *例: カップ麺 (HP大回復 / 満腹度大)*
*   **Drink (飲料)**: カフェイン操作が主。
    *   *例: エナドリ (カフェイン大増 / SAN微減)*
*   **Candy (菓子)**: 微調整用。安価で低リスク。
    *   *例: グミ (SAN微回復)*

### 2.2 Gadgets (永続・長時間効果)
バフを付与するアイテム。`activeBuffs` 配列に追加される。
*   **設計制約**: 高額なガジェットは「買った瞬間から元が取れる」レベルの性能、あるいは「安価で長く使える」コスパの良さのどちらかを持たせる。
*   *例: ホットアイマスク (休息効率UP / 4ターン)*

### 2.3 Key Items (重要アイテム)
イベントトリガーやパッシブ効果を持つ非売品。
*   **USBメモリ**: 「60点の壁」を超えるための必須アイテム。
    *   *効果*: 成功時 +20点 / 失敗時 -20 SAN
    *   *成功率*: アルゴリズム知識依存 (Min 30% -> Max 95%)
*   **検証済み過去問**: 上位互換。成功率98%。

---

## 3. アイテムカタログ & バランス・マトリクス

実装済みの主要アイテムとその役割定義です。（価格改定 v2.3）

| ID | Name | Price | 主効果 | 副作用/コスト | 役割・戦略 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| `BLACK_COFFEE` | 缶コーヒー | 160 | CFN+50 | - | **[基本]** 安価な覚醒維持。 |
| `ENERGY_DRINK` | ZONe | 550 | CFN+120 | SAN-5 | **[瞬発]** 一気にZONEへ。SANを犠牲にする。 |
| `MINERAL_WATER`| 水 | 120 | CFN-15 | - | **[調整]** 中毒回避用。安価。 |
| `HERBAL_TEA` | ハーブティー | 550 | CFN-100 | SAN+35 | **[治療]** 中毒からの緊急脱出。 |
| `RICE_BALL` | おにぎり | 150 | HP+15 | 満腹+50 | **[生存]** 最低限のカロリー摂取。 |
| `CUP_RAMEN` | 激辛カップ麺 | 480 | HP+55 | 満腹+75 | **[回復]** 瀕死からの復帰。連食不可。 |
| `EARPLUGS` | 耳栓 | 980 | SAN+50 | - | **[防衛]** 手軽なSAN回復手段へ変更。 |
| `HOT_EYE_MASK` | アイマスク | 850 | Rest x1.5 | - | **[休息]** 安価な休息ブースト。 |
| `GAMING_SUPPLEMENT`| ゲーミングサプリ| 2980 | Study x1.25| SAN-4/turn | **[ブースト]** 中盤の加速装置。価格適正化。 |
| `SMART_DRUG` | 怪しいサプリ | 14800| Study x2.5 | HP-40, SAN-12/t | **[切り札]** 終盤の逆転。倍率強化・価格低下。 |
| `REFERENCE_BOOK`| 「わかる」本 | 5800 | 最低科目+20 | - | **[救済]** 「金で単位を買う」現実的な選択肢。 |

---

## 4. バフ・デバフ設計 (Status Effects)

### 4.1 STUDY_EFFICIENCY (学習効率)
*   乗算で適用。
*   Soft Cap: 累積倍率が極端に高くならないよう、`applySoftCap` 関数で減衰させる。
*   推奨レンジ: 1.1倍 〜 2.5倍

### 4.2 REST_EFFICIENCY (休息効率)
*   HP/SAN回復量に乗算。
*   睡眠負債（Sleep Debt）の影響を受ける前に適用される。

### 4.3 SANITY_DRAIN (スリップダメージ)
*   毎ターン終了時にSANを減少させる。
*   強力な効果（サプリ等）の代償として設定する。

---

## 5. 追加プロセス (New Item Protocol)

新しいアイテムを追加する際は、以下の手順を踏んでください。

1.  **`types/enums.ts`**: `ItemId` にキーを追加。
2.  **`data/items.ts`**: アイテムデータを定義。
    *   効果は `GameEventEffect` 型に準拠させる。
    *   特殊な挙動（確率発動など）が必要な場合は `logic/handlers/items.ts` に分岐処理を書く。
3.  **`config/gameBalance.ts`**: 必要に応じて価格や効果量の定数を追加。
4.  **`ITEMS_DESIGN.md`**: このドキュメントにアイテムを追加し、意図を記述。

### 5.1 モジュール構成ガイド (Line Count-Free Policy)
複数カテゴリのロジックが `items.ts` に集積し始めた場合は以下の指標で再編を検討する:
- **語彙混在**: Consumables / Gadgets / Key Items の計算・効果付与ロジックが同居し条件分岐が増大。
- **変更チャーン**: 価格調整・効果係数・成功率計算の修正が無関係に頻発。
- **テスト負荷**: 特殊挙動アイテムの追加でハンドラが肥大化しユニットテストが困難。
再編時は `data/items/` 下にカテゴリ別ファイル + 集約インデックス (`data/items/index.ts`) を設け、**Effect定義の純粋性** と **計算ハンドラの副作用境界** を分離する。

---

## 6. バージョン履歴

*   **v2.4**: 行数制限撤廃。モジュール再編の質的指標 (語彙境界/チャーン/複雑度) を導入。
*   **v2.3**: アイテム価格の大幅見直し。高ティアアイテムの価格を30〜60%カットし、効果を上方修正。
*   **v2.1**: `USB_MEMORY` の成功率計算式を変更（アルゴリズム60点で確定成功へ）。
*   **v2.0**: 満腹度システム導入に伴い、食品系アイテムのパラメータを全面刷新。
*   **v1.0**: 初期リリース。基本セット定義。